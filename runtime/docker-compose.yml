version: "3.9"

services:
  mcp-assets:
    build:
      context: ..
      dockerfile: mcp_servers/assets/Dockerfile
    volumes:
      - ..:/app
    environment:
      MCP_TRANSPORT: "sse"
      MCP_HOST: "0.0.0.0"
      MCP_PORT: "7101"
      MCP_PATH: "/mcp"
    ports:
      - "7101:7101"

  mcp-memory:
    build:
      context: ..
      dockerfile: mcp_servers/memory/Dockerfile
    volumes:
      - ..:/app
    environment:
      MCP_TRANSPORT: "sse"
      MCP_HOST: "0.0.0.0"
      MCP_PORT: "7102"
      MCP_PATH: "/mcp"
    ports:
      - "7102:7102"

  mcp-tts:
    build:
      context: ..
      dockerfile: mcp_servers/tts/Dockerfile
    volumes:
      - ..:/app
    environment:
      MCP_TRANSPORT: "sse"
      MCP_HOST: "0.0.0.0"
      MCP_PORT: "7103"
      MCP_PATH: "/mcp"
    ports:
      - "7103:7103"

  mcp-lipsync:
    build:
      context: ..
      dockerfile: mcp_servers/lipsync/Dockerfile
    gpus: all
    volumes:
      - ..:/app
    environment:
      MCP_TRANSPORT: "sse"
      MCP_HOST: "0.0.0.0"
      MCP_PORT: "7104"
      MCP_PATH: "/mcp"
      NVIDIA_VISIBLE_DEVICES: all
      NUMBA_CACHE_DIR: /tmp/numba_cache
    ports:
      - "7104:7104"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: ["gpu"]

  mcp-render:
    build:
      context: ..
      dockerfile: mcp_servers/render/Dockerfile
    volumes:
      - ..:/app
    environment:
      MCP_TRANSPORT: "sse"
      MCP_HOST: "0.0.0.0"
      MCP_PORT: "7105"
      MCP_PATH: "/mcp"
      FFMPEG_BIN: "ffmpeg"
    ports:
      - "7105:7105"

  mcp-qc:
    build:
      context: ..
      dockerfile: mcp_servers/qc/Dockerfile
    volumes:
      - ..:/app
    environment:
      MCP_TRANSPORT: "sse"
      MCP_HOST: "0.0.0.0"
      MCP_PORT: "7106"
      MCP_PATH: "/mcp"
      FFMPEG_BIN: "ffmpeg"
      FFPROBE_BIN: "ffprobe"
    ports:
      - "7106:7106"
